Siap, Bang. Ini **checklist lengkap & pelanâ€‘pelan** supaya penggantian `apps_script_code.gs` berjalan mulus dan nonâ€‘SVG nggak muncul lagi di galeri.

***

## âœ… Checklist langkah demi langkah

### 1) Persiapan & backup

*   [ ] **Backup** dulu isi `apps_script_code.gs` lama (copy ke file lain).
*   [ ] Pastikan Abang pegang **FOLDER\_ID** (folder Drive berisi SVG) & **SHEET\_ID** (Spreadsheet untuk counter).

### 2) Ganti script di Google Apps Script

*   [ ] Buka **Apps Script** project Abang.
*   [ ] Buka file `apps_script_code.gs` â†’ **hapus isi lama** â†’ **paste** script versi **ketat** yang saya kirim sebelumnya.
*   [ ] **Edit konfigurasi** di atas file:
    *   `FOLDER_ID` â†’ isi dengan ID folder SVG.
    *   `SHEET_ID` â†’ isi dengan ID Spreadsheet (sheet `downloads` akan dibuat otomatis jika belum ada).
*   [ ] **Save** (Ctrl/Cmd+S).

### 3) Aktifkan Advanced Drive Service (wajib)

*   [ ] Di editor Apps Script, klik ikon **Services (puzzle)**.
*   [ ] Klik **+** â†’ cari **Drive API** â†’ **Add**.
*   [ ] (Opsional) Jalankan fungsi apa pun (mis. `handleList_` via `doGet` test) agar Apps Script meminta **otorisasi** â†’ izinkan.

> Catatan: Ini adalah **Advanced Google Service** (bukan `DriveApp`). Tanpa langkah ini, `Drive.Files.list` akan gagal.

### 4) Pastikan Google Drive API aktif di Cloud Project

*   [ ] Di Apps Script â†’ **Project Settings** â†’ **Google Cloud Platform (GCP) Project** â†’ **Open in Cloud Console**.
*   [ ] Di Cloud Console â†’ **APIs & Services â†’ Enabled APIs & services**.
*   [ ] Pastikan **Google Drive API** statusnya **Enabled**. Kalau belum â†’ **Enable**.

### 5) Deploy ulang Web App

*   [ ] **Deploy â†’ Manage deployments** â†’ pilih deployment yang ada â†’ **Edit** (atau **New deployment** â†’ **Web app**).
*   [ ] **Execute as**: **Me (akun Abang)**.
*   [ ] **Who has access**: **Anyone** / **Anyone with the link** (sesuaikan kebutuhan akses publik).
*   [ ] **Deploy** â†’ catat **Web app URL** (ini yang jadi `API_URL` di frontâ€‘end).

### 6) Update frontâ€‘end

*   [ ] Di `script.js` (frontâ€‘end), set:
    ```js
    const API_URL = '<<WEB_APP_URL_BARU>>';
    ```
*   [ ] **Hard reload** (Ctrl+Shift+R) atau tambahkan cache-buster saat uji:
    *   `.../exec?action=list&_=${Date.now()}`.

### 7) Uji endpoint satuâ€‘satu (di browser)

*   [ ] **List**: buka\
    `https://.../exec?action=list`\
    â†’ Harus berupa JSON dengan `files` **hanya** SVG.\
    â†’ Cek cepat: semua `mimeType` = `image/svg+xml`.
*   [ ] **Raw (SVG valid)**: ambil `id` dari list â†’ buka\
    `https://.../exec?action=raw&id=<<ID>>`\
    â†’ Harus menampilkan konten SVG. **Response header** harus `image/svg+xml; charset=utf-8`.
*   [ ] **Raw (ID nonâ€‘SVG)**: coba ID nonâ€‘SVG (kalau ada) â†’ harus balas **â€œBukan file SVGâ€**.
*   [ ] **Hit counter**:\
    `https://.../exec?action=hit&id=<<ID>>` â†’ respon `{ ok: true, count: <angka> }`.\
    â†’ Buka Spreadsheet â†’ sheet `downloads` bertambah/naik.
*   [ ] **Download (DL)**:\
    `https://.../exec?action=dl&id=<<ID>>` â†’ redirect ke unduhan Drive & counter ikut naik.

### 8) Uji galeri di UI

*   [ ] Buka halaman galeri â†’ **hanya SVG yang tampil**.
*   [ ] Coba tombol **720/1080/1920** â†’ unduhan sukses, counter naik.
*   [ ] Kalau thumbnail tidak muncul untuk item tertentu, lihat bagian **Tips thumbnail** di bawah.

***

## ğŸ”§ Tips & opsi tambahan (opsional, membantu banget)

### A) Pastikan thumbnail tampil untuk publik

*   Link `thumbnailLink` dari Drive kadang butuh auth dan bisa kosong untuk SVG tertentu.
*   Di script ketat, kita pakai `thumbnailLink` **fallback** ke:
        https://lh3.googleusercontent.com/d/<<ID>>=w300-h300-c
*   Jika gambar thumbnail masih **blank** karena aturan share:
    *   **Solusi cepat** (khusus SVG): gunakan endpoint `raw` sebagai sumber `<img>`:
        ![Visualization](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA+gAAAALCAYAAADsm6dVAAABHklEQVR4AezX0QqAIAwF0Oj/Pzp68SUoBHObniCIRN3Onu55eAgQIECAAAECBAgQIECAAIFwgZ8Denh/CiBAgAABAgQIECBAgAABAiUEagf0EsSKJECAAAECBAgQIECAAAEC3wIC+ouRJQIECBAgQIAAAQIECBAgMEtAQJ8l/bzHHwIECBAgQIAAAQIECBAg0AQE9Eax2od+CBAgQIAAAQIECBAgQKCSgIBeaVqZalULAQIECBAgQIAAAQIECAwVENCHcjpslIBzCBAgQIAAAQIECBAgsJuAgL7bxPV7C3gJECBAgAABAgQIECCQTkBATzcSBdUX0AEBAgQIECBAgAABAgT6BQT0fjM7CMQKuJ0AAQIECBAgQIAAgSUFLgAAAP//mkeKXAAAAAZJREFUAwC7ZwAXslr6lwAAAABJRU5ErkJggg==)
        Browser bisa render SVG langsung; ini **tidak tergantung** thumbnail Drive.
    *   Atau share file/folder sebagai **Anyone with the link (Viewer)** di Drive (sesuai kebijakan akses Abang).

### B) Frontâ€‘end filter (opsional safety net)

Walau server sudah ketat, boleh tetap saring di frontâ€‘end:

```js
const files = (data.files || []).filter(f => f.mimeType === 'image/svg+xml');
```

### C) Batasi payload (opsional)

Di Advanced Drive Service, `Drive.Files.list` bisa diberi `fields` untuk hemat data. Jika layanan Abang mengembalikan struktur **v3** (punya `files`), boleh pakai:

```javascript
const res = Drive.Files.list({
  q,
  pageSize: 200,
  fields: 'files(id, name, mimeType, thumbnailLink)'
});
```

> Jika yang kembali `items` (gaya v2), hilangkan `fields` atau sesuaikan ke format v2.

***

## ğŸ§ª Troubleshooting cepat

*   **Error: â€œYou do not have permission to call Drive.Files.listâ€**\
    â†’ Advanced Drive Service **belum diaktifkan** di Apps Script, atau belum diâ€‘authorize. Aktifkan di **Services**, lalu **Deploy ulang**.

*   **`action=list` tetap kosong** padahal folder ada file:
    *   Cek `FOLDER_ID` benar.
    *   Pastikan file SVG benarâ€‘benar terdeteksi Drive sebagai `image/svg+xml` (bukan `application/octet-stream`).
        > Dengan mode **ketat**, file yang salah MIME **tidak** akan muncul. Kalau perlu meloloskan yang â€œkontennya SVG tapi MIME salahâ€, kabari yaâ€”nanti saya kirim versi kompromi (cek tag `<svg>`).

*   **403/401 di frontâ€‘end** saat fetch:
    *   Cek **Deploy** â€œWho has accessâ€ = **Anyone**.
    *   API\_URL benar dan tidak typo.
    *   CORS sudah diâ€‘set oleh `withCors_` (sudah OK di script kita).

*   **Spreadsheet tidak terupdate**:
    *   Cek `SHEET_ID` & sheet `downloads` ada.
    *   Script **Execute as: Me** agar punya akses edit Spreadsheet.

*   **Thumbnail tidak muncul**:
    *   Pakai `<img src="API_URL?action=raw&id=...">` (untuk SVG ini paling aman).
    *   Atau atur sharing Drive.

***

## ğŸš€ Ringkasan komando uji (copyâ€‘paste URL di address bar)

*   List:\
    `API_URL?action=list`
*   Raw:\
    `API_URL?action=raw&id=FILE_ID`
*   Hit:\
    `API_URL?action=hit&id=FILE_ID`
*   Download:\
    `API_URL?action=dl&id=FILE_ID`

> Tambahkan `&_=${Date.now()}` untuk bypass cache saat debugging.

***

Kalau sudah jalan, kirim screenshot `action=list` dan satu kartu di galeriâ€”biar saya bantu sanity check cepat. Kalau Abang nanti ingin **versi kompromi** (meloloskan SVG yang MIMEâ€‘nya keliru) atau **pakai `fields` yang hemat data** sesuai versi Drive API yang muncul, tinggal bilangâ€”saya bikinin variannya. ğŸ‘ğŸ»
